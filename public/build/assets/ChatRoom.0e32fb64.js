import{T as L}from"./TextInput.1b514844.js";import{_ as t}from"./Translate.dc83ae5b.js";import{b as A}from"./index.esm.88a1fe10.js";import{c as D}from"./index.esm.20d0c837.js";import{b as N,c as S,a as O}from"./index.esm.68978a19.js";import{Q as d}from"./react-toastify.esm.bdf47744.js";import{r as n,b as I,d as h,j as r,a as s,F as m,g as R}from"./app.01478f3a.js";import z from"./TipPopup.8d5de071.js";import{S as G}from"./SecondaryButton.ce2b9b92.js";import{M as J}from"./react-tooltip.min.03bee161.js";/* empty css                          */import{M as Q}from"./Modal.efe60ae3.js";import{P as Y}from"./PrimaryButton.d4bb1c88.js";import"./iconBase.b9bf8c21.js";import"./InputLabel.6a083efe.js";import"./Textarea.699edce8.js";import"./NumberInput.154f1974.js";import"./transition.054c8d20.js";function fe({streamer:i,forceScroll:M=!1}){const[w,v]=n.exports.useState([]),[y,C]=n.exports.useState(""),[T,k]=n.exports.useState(!1),[q,U]=n.exports.useState(0),{auth:c,pusher:K}=I().props,[u,f]=n.exports.useState(!1),[l,g]=n.exports.useState(null),[F,p]=n.exports.useState(null),{coins_sound:B}=I().props,E=new Audio(B),x=n.exports.useRef(),_=`room-${i.username}`,$=e=>{var o;((o=c==null?void 0:c.user)==null?void 0:o.id)===i.id&&i.id!==e&&(p(null),g(null),f(!u),h.post(route("profile.modalUserInfo",{user:e})).then(a=>{g(a.data)}).catch(a=>d.error(t("Error loading user infos for the modal"))))},H=(e,o)=>{e.preventDefault(),h.post(route("channel.banUserFromRoom",{user:o})).then(a=>{d.success(t("User has been banned!")),g(null),p(null),f(!u)}).catch(a=>d.error(t("Error banning user")))},j=e=>{const o=e.scrollTop+e.clientHeight;o==e.scrollHeight?k(!1):k(!0),U(o)},b=()=>{var e;if(!T){const{offsetHeight:o,scrollHeight:a,scrollTop:V}=x.current;(e=x.current)==null||e.scrollTo(0,a)}};n.exports.useEffect(()=>{b()},[w]),n.exports.useEffect(()=>{h.get(route("chat.latestMessages",{roomName:_})).then(e=>{v(e.data)}).catch(e=>d.error(`Loading latest messages: ${e.message}`)),window.Echo.channel(_).listen(".livechat",e=>{v(o=>[...o,e.chat]),e.chat.tip>0&&E.play()}),M&&b()},[]);const P=e=>{e.preventDefault(),h.post(route("chat.sendMessage",{user:i.id}),{message:y}).then(()=>C("")).catch(o=>{var a;d.error((a=o.response.data)==null?void 0:a.message)}),b()};return r("div",{className:"flex flex-col w-full lg:w-[400px] h-[270px] sm:h-[360px] lg:h-[536px] bg-white dark:bg-zinc-900 dark:border-zinc-900 ",children:[r(Q,{show:u,onClose:e=>f(!1),children:[!l&&t("Loading user infos.."),l&&s("div",{className:"p-5 text-gray-600 dark:text-gray-100 text-lg",children:r("div",{className:"flex items-center",children:[s("div",{children:s("img",{src:l.profile_picture,alt:"",className:"rounded-full w-20 border-2 border-indigo-100"})}),r("div",{className:"pl-3 flex-grow",children:[s("h3",{className:"text-lg font-semibold",children:l.name}),r("p",{className:"text-sm",children:["@",l.username]}),s("p",{className:"text-sm flex",children:l.channel_follower?r(m,{children:[s(N,{className:"mt-0.5 mr-1"}),t("Follows your channel")]}):r(m,{children:[s(N,{className:"mt-0.5 mr-1"}),t("Doesn't follow your channel")]})}),s("p",{className:"text-sm flex",children:l.channel_follower?r(m,{children:[s(S,{className:"mt-0.5 mr-1"}),t("Subscribed on Tier: :tier",{tier:l.membership_tier})]}):r(m,{children:[s(S,{className:"mt-0.5 mr-1"}),t("Not subscribed to your channel")]})})]}),s("div",{className:"justify-end",children:l.is_user_banned?s("p",{children:t("Banned on :date",{date:l.banned_date})}):F===null?r(Y,{onClick:e=>p(l.id),children:[s(O,{className:"mr-1"}),t("Ban User")]}):r(m,{children:[t("Are you sure?"),s("br",{}),s("button",{onClick:e=>H(e,l.id),className:"text-red-600 hover:underline font-semibold",children:t("Yes, ban")}),s("button",{onClick:e=>p(null),className:"ml-2 text-indigo-500 hover:underline font-semibold",children:t("Cancel")})]})})]})})]}),r("div",{ref:x,onScroll:e=>j(e.currentTarget),className:"flex-grow  text-gray-700 text-sm dark:text-white pl-2  relative overflow-scroll",children:[r("h3",{className:"font-semibold pt-5 text-lg flex items-center justify-center",children:[s(A,{className:"mr-2"}),t("Live Chat")]}),w.map(e=>r("p",{className:`py-2 ${e.tip>0&&"bg-yellow-200 rounded-lg p-2 text-gray-900 my-2"}`,children:[e.user_id===i.id&&s("span",{children:s(D,{"data-tooltip-content":t("Channel Owner"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"-mt-0.5 mr-1 inline text-pink-600"})}),e.isFollower&&s("span",{children:s(N,{"data-tooltip-content":t("Channel Follower"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"mr-1 inline text-cyan-600"})}),e.isSubscriber&&s("span",{children:s(S,{"data-tooltip-content":t("Channel Subscriber"),"data-tooltip-id":`chatmsg-subscriber-${e.id}`,className:"mr-1 inline text-fuchsia-500"})}),s(J,{anchorSelect:"svg"}),r("span",{onClick:o=>$(e.user_id),className:`font-semibold cursor-pointer ${e.user_id===i.id?"text-pink-600":"text-indigo-500 dark:text-indigo-400"}`,children:[e.user.username,": "]}),e.tip>0&&t("Just tipped :tip tokens! ",{tip:e.tip}),s("span",{className:"break-all",children:e.message})]},`msg-${e.id}`))]}),r("div",{className:"py-5 px-2 flex items-center",children:[r("div",{className:"mr-2 flex-grow",children:[c.user&&s("form",{onSubmit:P,children:s(L,{name:"chat_message",className:"w-full",placeholder:t("Enter message & press enter"),value:y,handleChange:e=>C(e.target.value)})}),!c.user&&s(G,{className:"w-full py-3",onClick:e=>R.Inertia.visit(route("login")),children:t("Login to Chat")})]}),s("div",{children:s(z,{streamer:i})})]})]})}export{fe as default};
